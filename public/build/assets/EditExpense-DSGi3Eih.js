import{r as d,b as P,k as E,j as e}from"./index-C2h9iXsq.js";import{a as G,b as D}from"./api-C2dAnRUz.js";import{r as k}from"./Feilds-BHjWXeSc.js";import{u as R,a as O,b as V,c as z,d as H,e as U}from"./DefaultLayout-Bb3k2Kjc.js";import{C as $}from"./CForm-BVvPNiqY.js";import{C as r}from"./CFormLabel-DkkhltaS.js";import{C as _}from"./CFormSelect-ukCskt8P.js";import{C as c}from"./CFormInput-Da28fgYD.js";import{C as T}from"./CButton--W_4ZeJh.js";const ae=({visible:o,onClose:y,expense:i,onExpenseUpdated:g})=>{const[A,h]=d.useState(!1),[w,F]=d.useState([]),[x,b]=d.useState(!1),{showToast:p}=P(),{t:n}=R("global"),[a,u]=d.useState({name:"",desc:"",expense_id:void 0,qty:1,price:0,total_price:0,expense_date:new Date().toISOString().split("T")[0],show:!0,gst:"",sgst:"",cgst:"",igst:"",contact:"",payment_by:"",payment_type:"",pending_amount:"",isGst:0,photoAvailable:0,photo_url:"",photo_remark:"",bank_name:"",acc_number:"",ifsc:"",aadhar:"",pan:"",transaction_id:""}),v=()=>localStorage.getItem("i18nextLng")||E.language||"en",B=(s,l=null)=>(l||v())==="mr"&&s.localName||s.name,S=async()=>{try{const s=await G("/api/expenseType");F(s.filter(l=>l.show===1))}catch(s){p("danger","Error occurred "+s)}};d.useEffect(()=>{o&&S()},[o]),d.useEffect(()=>{o&&S()},[E.language,o]),d.useEffect(()=>{i&&o&&(u({...a,...i,expense_date:i.expense_date||new Date().toISOString().split("T")[0],show:i.show!==void 0?i.show:!0}),h(!1))},[i,o]);const C=s=>Number((Math.round(s*100)/100).toFixed(2)),M=s=>{const l=C(parseFloat(s.qty)||0),m=C(parseFloat(s.price)||0);s.total_price=Math.round(l*m)},t=s=>{const{name:l,value:m}=s.target;["price","qty"].includes(l)?u(j=>{const N={...j,[l]:m};return M(N),N}):u(j=>({...j,[l]:m}))},f=async s=>{if(s.preventDefault(),s.stopPropagation(),h(!0),a.expense_id&&a.price>0&&a.qty>0){b(!0);try{const l={...a,id:i.id};await D(`/api/expense/${i.id}`,l)?(p("success",n("MSG.expense_updated_successfully")),g&&g(l),y()):p("danger",n("MSG.error_occured_please_try_again_later_msg"))}catch(l){p("danger","Error occurred "+l)}finally{b(!1)}}else p("danger",n("MSG.fill_required_fields"))},L=()=>{h(!1),y()},I=new Date().toISOString().split("T")[0],q=v();return e.jsxs(O,{visible:o,onClose:L,size:"xl",children:[e.jsx(V,{children:e.jsx(z,{children:n("LABELS.edit_expense")})}),e.jsx(H,{children:e.jsxs($,{noValidate:!0,validated:A,onSubmit:f,children:[e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-sm-6 mb-3",children:[e.jsx(r,{children:e.jsx("b",{children:n("LABELS.expense_type")})}),e.jsxs(_,{name:"expense_id",value:a.expense_id||"",onChange:t,required:!0,children:[e.jsx("option",{value:"",children:n("MSG.select_expense_type_msg")}),w.map(s=>e.jsx("option",{value:s.id,children:B(s,q)},s.id))]})]}),e.jsxs("div",{className:"col-sm-6 mb-3",children:[e.jsx(r,{children:e.jsx("b",{children:n("LABELS.about_expense")})}),e.jsx(c,{name:"name",value:a.name,onChange:t,placeholder:"Enter expense name"})]})]}),e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-sm-4 mb-3",children:[e.jsx(r,{children:e.jsx("b",{children:n("LABELS.expense_date")})}),e.jsx(c,{type:"date",name:"expense_date",max:I,value:a.expense_date,onChange:t,required:!0})]}),e.jsxs("div",{className:"col-sm-4 mb-3",children:[e.jsx(r,{children:e.jsx("b",{children:n("LABELS.price_per_unit")})}),e.jsx(c,{type:"number",name:"price",min:"0",step:"0.01",value:a.price,onChange:t,required:!0})]}),e.jsxs("div",{className:"col-sm-4 mb-3",children:[e.jsx(r,{children:e.jsx("b",{children:n("LABELS.total_units")})}),e.jsx(c,{type:"number",name:"qty",step:"0.01",min:"0",value:a.qty,onChange:t,required:!0})]}),e.jsxs("div",{className:"col-sm-4 mb-3",children:[e.jsx(r,{children:e.jsx("b",{children:n("LABELS.total_price")})}),e.jsx(c,{readOnly:!0,name:"total_price",value:a.total_price})]})]}),e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"row",children:e.jsxs("div",{className:"col-sm-4 mb-3",children:[e.jsx(r,{htmlFor:"payment_by",children:e.jsx("b",{children:n("LABELS.payment_by")})}),e.jsxs(_,{id:"payment_by",name:"payment_by",value:a.payment_by,onChange:t,children:[e.jsx("option",{value:"",children:n("LABELS.select_payment_by")}),k.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))]})]})}),e.jsxs("div",{className:"col-sm-4 mb-3",children:[e.jsx(r,{children:e.jsx("b",{children:n("LABELS.payment_type")})}),e.jsxs(_,{name:"payment_type",value:a.payment_type||"",onChange:t,children:[e.jsx("option",{value:"",children:"Select Payment Type"}),e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"upi",children:"UPI"}),e.jsx("option",{value:"IMPS/NEFT/RTGS",children:"IMPS/NEFT/RTGS"})]})]}),(a.payment_type==="upi"||a.payment_type==="IMPS/NEFT/RTGS")&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"col-sm-3 mb-3",children:[e.jsx(r,{children:e.jsx("b",{children:"Transaction ID"})}),e.jsx(c,{name:"transaction_id",value:a.transaction_id||"",onChange:t})]})})]}),a.payment_type==="IMPS/NEFT/RTGS"&&e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-sm-3 mb-3",children:[e.jsx(r,{children:e.jsx("b",{children:"Bank Name"})}),e.jsx(c,{name:"bank_name",value:a.bank_name||"",onChange:t})]}),e.jsxs("div",{className:"col-sm-3 mb-3",children:[e.jsx(r,{children:e.jsx("b",{children:"Account Number"})}),e.jsx(c,{name:"acc_number",value:a.acc_number||"",onChange:t})]}),e.jsxs("div",{className:"col-sm-3 mb-3",children:[e.jsx(r,{children:e.jsx("b",{children:"IFSC"})}),e.jsx(c,{name:"ifsc",value:a.ifsc||"",onChange:t})]})]}),e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-sm-4 mb-3",children:[e.jsx(r,{children:e.jsx("b",{children:"Aadhar Number"})}),e.jsx(c,{name:"aadhar",value:a.aadhar||"",onChange:t})]}),e.jsxs("div",{className:"col-sm-4 mb-3",children:[e.jsx(r,{children:e.jsx("b",{children:"PAN"})}),e.jsx(c,{name:"pan",value:a.pan||"",onChange:t})]}),e.jsxs("div",{className:"col-sm-4 mb-3",children:[e.jsx(r,{children:e.jsx("b",{children:"Pending Amount"})}),e.jsx(c,{type:"number",name:"pending_amount",value:a.pending_amount||0,onChange:t})]})]})]})}),e.jsxs(U,{children:[e.jsx(T,{color:"secondary",onClick:L,disabled:x,children:n("LABELS.cancel")}),e.jsx(T,{color:"primary",onClick:f,disabled:x,children:x?"Updating...":n("LABELS.update_expense")})]})]})};export{ae as E};
