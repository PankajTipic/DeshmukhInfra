import{d as g,u as A,e as v,r as s,b as N,j as c}from"./index-C2h9iXsq.js";import{a as h,b as j}from"./api-C2dAnRUz.js";import S from"./Invoice-Dar6IdIE.js";import{u as I}from"./DefaultLayout-Bb3k2Kjc.js";/* empty css                */import"./index.esm-DQbyd5df.js";import"./ProjectSelectionModal-B4H1mPqU.js";import"./CFormInput-Da28fgYD.js";import"./CFormControlWrapper-CgtL4Ts4.js";import"./CFormLabel-DkkhltaS.js";import"./CTable-B2fFA3gN.js";import"./CButton--W_4ZeJh.js";import"./CCardBody-DHWC5_BS.js";import"./CCardHeader-BOYr8GAh.js";import"./CForm-BVvPNiqY.js";import"./CInputGroup-DQyo9You.js";import"./CInputGroupText-UmKIgDi2.js";import"./cil-x-0440B5Ce.js";import"./cil-search-CDkY_4k-.js";import"./cil-plus-D8mtC-W5.js";import"./CFormSelect-ukCskt8P.js";import"./cil-pencil-m516yCOw.js";import"./CFormTextarea-OofZxR1Z.js";import"./RawMaterial-BtjEDAbB.js";import"./cil-mobile-CRjBRZgk.js";const Z=()=>{const{id:a}=g(),d=A(),p=v(),i=new URLSearchParams(p.search).get("convertTo"),[u,l]=s.useState(null),[_,y]=s.useState(!0),[f,b]=s.useState(!1),{showToast:n}=N(),{t:o}=I("global");s.useEffect(()=>{(async()=>{try{const e=await h(`/api/order/${a}`);if(console.log("Fetched order:",e),e){const t=e.project||{};l({projectId:e.project_id||t.id||null,customer_id:e.customer_id||null,projectName:t.project_name||"N/A",customer:{name:t.customer_name||"Unknown",address:t.work_place||"",mobile:t.mobile_number||""},lat:e.lat||"",long:e.long||"",payLater:!!e.payLater,isSettled:!!e.isSettled,invoiceDate:e.invoiceDate||"",deliveryTime:e.deliveryTime||"",deliveryDate:e.deliveryDate||"",invoiceType:i?parseInt(i):e.invoiceType||3,orderStatus:i?parseInt(i):e.orderStatus||1,items:(e.items||[]).map(r=>({id:r.id,work_type:r.work_type||"",uom:r.uom||"",qty:Number(r.qty||0),price:Number(r.price||0),total_price:Number(r.total_price||0),remark:r.remark||""})),totalAmount:Number(e.totalAmount||0),discount:Number(e.discount||0),paidAmount:Number(e.paidAmount||0),finalAmount:Number(e.finalAmount||0),balanceAmount:Number(e.finalAmount||0)-Number(e.paidAmount||0),paymentType:e.paymentType||0,company_id:e.company_id||null,payment_terms:e.payment_terms||"",terms_and_conditions:e.terms_and_conditions||"",note:e.note||"",ref_id:e.ref_id||"",po_number:e.po_number||""}),b(!0)}else n("danger","No order data found")}catch(e){console.error("Fetch order error:",e),n("danger",o("TOAST.fetch_order_failed"))}finally{y(!1)}})()},[a,i,o]);const T=async m=>{try{const e={...m,id:a,project_id:m.projectId,remainingBalance:Number(m.finalAmount||0)-Number(m.paidAmount||0)};console.log("Updating order:",e);const t=await j(`/api/order/${a}`,e);t!=null&&t.success?(n("success",o("TOAST.order_updated")),d(`/invoice-details/${a}`)):n("danger",(t==null?void 0:t.message)||o("TOAST.update_failed"))}catch(e){console.error("Update error:",e),n("danger",o("TOAST.update_error"))}};return _||!f?c.jsx("div",{children:o("TOAST.loading")}):c.jsx(S,{editMode:!0,initialData:u,onSubmit:T})};export{Z as default};
