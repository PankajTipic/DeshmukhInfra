import{r as i,u as je,b as ye,j as e}from"./index-C2h9iXsq.js";import{a as V,e as Se,d as ge}from"./api-C2dAnRUz.js";import{utils as _,writeFile as ve}from"./xlsx-B6sNpj_1.js";import{E as Ce}from"./jspdf.es.min-BwCsaKCZ.js";import"./jspdf.plugin.autotable-BqrGn1St.js";import{a as fe,b as v,c as Y}from"./index.esm-DQbyd5df.js";import{C as q,a as Te}from"./CCardBody-DHWC5_BS.js";import{C as _e}from"./CCardHeader-BOYr8GAh.js";import{C as d}from"./CButton--W_4ZeJh.js";import{C as J}from"./CFormInput-Da28fgYD.js";import{C as ke}from"./CFormSelect-ukCskt8P.js";import{C as be,a as De,b as K,c as s,d as Ne,e as o}from"./CTable-B2fFA3gN.js";import{c as Re}from"./cil-pencil-m516yCOw.js";import{c as Pe}from"./cil-trash-CBbKHhHb.js";import{a as Ee,b as He,c as Me,d as Ie,e as we}from"./DefaultLayout-Bb3k2Kjc.js";import"./typeof-QjJsDpFa.js";import"./jspdf.es.min-B0tN83gG.js";import"./CFormControlWrapper-CgtL4Ts4.js";import"./CFormLabel-DkkhltaS.js";import"./RawMaterial-BtjEDAbB.js";import"./cil-mobile-CRjBRZgk.js";function rt(){const[p,Q]=i.useState([]),[k,b]=i.useState(""),[D,N]=i.useState(""),[X,Z]=i.useState(""),[C,S]=i.useState(!1),[ee,te]=i.useState([]),[R,P]=i.useState(""),ae=je(),{showToast:f}=ye(),re=async()=>{try{const t=await V("/api/myProjects");te(t||[])}catch(t){console.error("Error fetching projects:",t)}};i.useEffect(()=>{re()},[]);const h=async(t={})=>{try{const l=Se();let c="/api/drilling";l===2&&(c="/api/getDataByUserId");const a=new URLSearchParams;t.start_date&&t.end_date&&(a.append("start_date",t.start_date),a.append("end_date",t.end_date)),t.project_name&&a.append("project_name",t.project_name),t.max_point&&a.append("max_point",t.max_point),[...a].length>0&&(c=`${c}?${a.toString()}`),S(!0);const r=(await V(c)).data,u=[];r.forEach((n,me)=>{var w,F,L,W,B,A,G,U,$,z,O;const pe=((w=n.work_point_detail)==null?void 0:w.length)||0,he=((F=n.survey_detail)==null?void 0:F.length)||0,xe=((L=n.machine_reading)==null?void 0:L.length)||0,ue=((W=n.compressor_rpm)==null?void 0:W.length)||0,I=Math.max(pe,he,xe,ue,1);for(let m=0;m<I;m++){const j=((B=n.work_point_detail)==null?void 0:B[m])||{},y=((A=n.survey_detail)==null?void 0:A[m])||{},g=((G=n.machine_reading)==null?void 0:G[m])||{},T=((U=n.compressor_rpm)==null?void 0:U[m])||{};u.push({srNo:me+1,date:n.date,site:(($=n.project)==null?void 0:$.project_name)||"",operator:((z=g.operator)==null?void 0:z.name)||((O=n.operator)==null?void 0:O.name)||"",machineStart:g.machine_start||"",machineEnd:g.machine_end||"",machineHr:g.actual_machine_hr||"",compressorStart:T.comp_rpm_start||"",compressorEnd:T.comp_rpm_end||"",compressorHr:T.com_actul_hr||"",workType:j.work_type||"",workPoint:j.work_point||"",workRate:j.rate||"",workTotal:Number(j.total)||0,surveyType:y.survey_type||"",surveyPoint:y.survey_point||"",surveyRate:y.rate||"",surveyTotal:Number(y.total)||0,rowTotal:(Number(j.total)||0)+(Number(y.total)||0),isFirstRow:m===0,rowSpan:I,drillingRecordId:n.id})}}),Q(u)}catch(l){console.error("Error fetching records:",l)}finally{S(!1)}},se=()=>{const t=["Sr.No.","Date","Site","Operator/Helper","Machine Start","Machine End","Machine Hr","Compressor rpm Start","Compressor rpm End","Compressor rpm Hr","Work Type","Point","Rate","Work Total","Survey Type","Survey Point","Survey Rate","Survey Total","Grand Total"],l=p.map(r=>[r.srNo,new Date(r.date).toLocaleDateString(),r.site,r.operator,r.machineStart,r.machineEnd,r.machineHr,r.compressorStart,r.compressorEnd,r.compressorHr,r.workType,r.workPoint,r.workRate,r.workTotal,r.surveyType,r.surveyPoint,r.surveyRate,r.surveyTotal,r.rowTotal]),c=_.aoa_to_sheet([t,...l]),a=_.book_new();_.book_append_sheet(a,c,"InfraDetails");const M=t.map((r,u)=>({wch:Math.max(r.length,...l.map(n=>n[u]?n[u].toString().length:0))+2}));c["!cols"]=M,ve(a,"InfraDetails.xlsx")},oe=()=>{const t=new Ce("l","mm","a4");t.setFontSize(8),t.text("Infra Details Report",14,8);const l=["Sr.No.","Date","Site","Operator","Machine Start","Machine End","Machine Hr","Compressor Start","Compressor End","Compressor Hr","Work Type","Point","Rate","Work Total","Survey Type","Survey Point","Survey Rate","Survey Total","Grand Total"],c=p.map(a=>[a.srNo,new Date(a.date).toLocaleDateString(),a.site,a.operator,a.machineStart,a.machineEnd,a.machineHr,a.compressorStart,a.compressorEnd,a.compressorHr,a.workType,a.workPoint,a.workRate,a.workTotal,a.surveyType,a.surveyPoint,a.surveyRate,a.surveyTotal,a.rowTotal]);t.autoTable({head:[l],body:c,startY:12,theme:"grid",styles:{fontSize:7,cellPadding:2,overflow:"linebreak",halign:"center",valign:"middle"},headStyles:{fillColor:[41,128,185],textColor:255,fontSize:7},tableWidth:"auto",pageBreak:"auto"}),t.save("InfraDetails.pdf")};i.useEffect(()=>{h()},[]);const ne=i.useMemo(()=>p.reduce((t,l)=>t+(Number(l.rowTotal)||0),0),[p]),le=()=>{h({start_date:k||void 0,end_date:D||void 0,project_name:R||void 0,max_point:X||void 0})},[ie,x]=i.useState(!1),[E,H]=i.useState(null),ce=t=>{H(t),x(!0)},de=async()=>{if(E){S(!0);try{await ge(`/api/drilling/${E}`)?(f("success","Entry deleted successfully!"),h==null||h()):f("danger","Failed to delete entry")}catch(t){console.error(t),f("danger","Something went wrong while deleting.")}finally{S(!1),x(!1),H(null)}}};return e.jsxs("div",{children:[e.jsx(q,{className:"mb-4",children:e.jsxs(_e,{children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2 flex-wrap gap-2",children:[e.jsxs("div",{className:"d-flex flex-wrap gap-2",children:[e.jsx(d,{color:"success",className:"me-2",onClick:se,children:"Download Excel"}),e.jsx(d,{color:"danger",className:"pe-3",onClick:oe,children:"Download PDF"})]}),e.jsxs("h4",{className:"mb-0",children:["Total Amount : ",ne]})]}),e.jsxs(fe,{className:"align-items-end d-flex flex-wrap gap-2",children:[e.jsx(v,{md:3,children:e.jsx(J,{type:"date",label:"Start Date",value:k,onChange:t=>b(t.target.value)})}),e.jsx(v,{md:3,children:e.jsx(J,{type:"date",label:"End Date",value:D,onChange:t=>N(t.target.value)})}),e.jsx(v,{md:3,children:e.jsxs(ke,{label:"Project Name",value:R,onChange:t=>P(t.target.value),children:[e.jsx("option",{value:"",children:"-- Select Project --"}),ee.map(t=>e.jsx("option",{value:t.project_name,children:t==null?void 0:t.project_name},t.id))]})}),e.jsxs(v,{md:3,children:[e.jsx(d,{color:"primary",onClick:le,children:"Apply"}),e.jsx(d,{color:"secondary",className:"ms-2",onClick:()=>{b(""),N(""),P(""),Z(""),h()},children:"Reset"})]})]})]})}),p.length>0&&e.jsx(q,{className:"mt-4",children:e.jsx(Te,{className:"p-0",children:e.jsx("div",{className:"table-responsive",children:e.jsxs(be,{bordered:!0,hover:!0,children:[e.jsx(De,{color:"dark",children:e.jsxs(K,{children:[e.jsx(s,{children:"Sr.No."}),e.jsx(s,{children:"Date"}),e.jsx(s,{children:"Site"}),e.jsx(s,{children:"Oprator/Helper"}),e.jsx(s,{children:"Machine Start"}),e.jsx(s,{children:"Machine End"}),e.jsx(s,{children:"Machine Hr"}),e.jsx(s,{children:"Compressor rpm Start"}),e.jsx(s,{children:"Compressor rpm End"}),e.jsx(s,{children:"Compressor rpm Hr"}),e.jsx(s,{children:"Work Type"}),e.jsx(s,{children:"Point"}),e.jsx(s,{children:"Rate"}),e.jsx(s,{children:"Work Total"}),e.jsx(s,{children:"Survey Type"}),e.jsx(s,{children:"Survey Point"}),e.jsx(s,{children:"Survey Rate"}),e.jsx(s,{children:"Survey Total"}),e.jsx(s,{children:"Grand Total"}),e.jsx(s,{children:"Action"})]})}),e.jsx(Ne,{children:p.map((t,l)=>e.jsxs(K,{children:[t.isFirstRow&&e.jsxs(e.Fragment,{children:[e.jsx(o,{rowSpan:t.rowSpan,children:t.srNo}),e.jsx(o,{rowSpan:t.rowSpan,children:new Date(t.date).toLocaleDateString("en-GB")}),e.jsx(o,{rowSpan:t.rowSpan,children:t.site})]}),e.jsx(o,{children:t.operator}),e.jsx(o,{children:t.machineStart}),e.jsx(o,{children:t.machineEnd}),e.jsx(o,{children:t.machineHr}),e.jsx(o,{children:t.compressorStart}),e.jsx(o,{children:t.compressorEnd}),e.jsx(o,{children:t.compressorHr}),e.jsx(o,{children:t.workType}),e.jsx(o,{children:t.workPoint}),e.jsx(o,{children:t.workRate}),e.jsx(o,{className:"fw-bold text-primary",children:t.workTotal}),e.jsx(o,{children:t.surveyType}),e.jsx(o,{children:t.surveyPoint}),e.jsx(o,{children:t.surveyRate}),e.jsx(o,{className:"fw-bold text-primary",children:t.surveyTotal}),e.jsx(o,{className:"fw-bold text-success",children:t.rowTotal}),t.isFirstRow&&e.jsx(o,{rowSpan:t.rowSpan,className:"text-center ",children:e.jsxs("div",{className:"d-flex justify-content-center gap-2",children:[e.jsx(d,{color:"primary",onClick:()=>ae(`/updateDrillingForm/${t.drillingRecordId}`,{state:{drillingRecordId:t.drillingRecordId}}),children:e.jsx(Y,{icon:Re})}),e.jsx(d,{color:"danger",onClick:()=>ce(t.drillingRecordId),children:e.jsx(Y,{icon:Pe})})]})})]},l))})]})})})}),e.jsxs(Ee,{visible:ie,onClose:()=>x(!1),backdrop:"static",children:[e.jsx(He,{onClose:()=>x(!1),children:e.jsx(Me,{children:"Delete drilling record?"})}),e.jsxs(Ie,{children:["Do you really want to"," ",e.jsx("span",{className:"text-danger fw-bold",children:"Delete"})," this record?"]}),e.jsxs(we,{children:[e.jsx(d,{color:"secondary",variant:"outline",onClick:()=>x(!1),disabled:C,children:"Close"}),e.jsx(d,{color:"danger",disabled:C,onClick:de,children:C?"Deletingâ€¦":"Yes"})]})]})]})}export{rt as default};
