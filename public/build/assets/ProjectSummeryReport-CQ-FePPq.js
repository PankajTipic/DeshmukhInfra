import{r as d,j as e,C as T}from"./index-D77JVx93.js";import{C as $,c as C,a as u,b as t}from"./index.esm-CnYARBHd.js";import{S as re}from"./react-select.esm-B7HflvLV.js";import{a as k}from"./api-C2dAnRUz.js";import{C as m,a as x}from"./CCardBody-CmpV1lA4.js";import{C as te}from"./CCardHeader-CTLciU6o.js";import{c as ne}from"./cil-file-CeQgYs_D.js";import{C as ce}from"./cil-mobile-CeKkmNgt.js";import{C as ie}from"./CForm-CvVYu-wE.js";import{c as oe}from"./cil-search-CDkY_4k-.js";import{C as n}from"./CFormLabel-Dc8HuNh9.js";import{C as c}from"./CFormInput-l8xIFq1a.js";import{C as i}from"./CInputGroup-iSurCesp.js";import{C as o}from"./CInputGroupText-BPolkdL-.js";import{C as de}from"./CButton-1GsZ7-l4.js";import{c as me}from"./cil-minus-DGBbwmfG.js";import{c as xe}from"./cil-plus-D8mtC-W5.js";import{C as he}from"./CCollapse-CgbX606t.js";import{C as E,a as H,b as v,c as j,d as U,e as b}from"./CTable-_iNV6x85.js";import{C as ue}from"./DefaultLayout-B9m2Op0L.js";import{c as je}from"./cil-location-pin-CQr6GRP7.js";import"./defineProperty-DJACW-dl.js";import"./typeof-QjJsDpFa.js";import"./emotion-react.browser.esm-CqI2bEna.js";import"./floating-ui.dom-ByRZgDQ1.js";import"./CFormControlWrapper-Bm4xoNnJ.js";import"./RawMaterial-BtjEDAbB.js";const Ue=()=>{const[S,z]=d.useState([]),[G,A]=d.useState(0),[I,L]=d.useState(!1),[O,Q]=d.useState([]),[q,P]=d.useState(""),[F,D]=d.useState(""),[N,f]=d.useState([]),[W,M]=d.useState(!1),[w,J]=d.useState(!1),[y,p]=d.useState([]),[K,R]=d.useState(!1);d.useState(!1);const r=s=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",minimumFractionDigits:2,maximumFractionDigits:2}).format(Number(s||0)),V=async s=>{if(s){M(!0);try{const a=await k(`/api/vendor-payments/${s}`);Array.isArray(a)?f(a):a&&a.data?f(a.data||[]):f([])}catch(a){console.error("Error fetching vendor payments:",a),f([])}finally{M(!1)}}},B=async s=>{if(s){R(!0);try{const a=await k(`/api/getRawMaterialsForSummary?project_id=${s}`);Array.isArray(a)?p(a):a&&a.data?p(a.data||[]):p([])}catch(a){console.error("Error fetching raw materials:",a),p([])}finally{R(!1)}}},X=()=>N.reduce((s,a)=>({totalAmount:s.totalAmount+Number(a.total_amount||0),paidAmount:s.paidAmount+Number(a.paid_amount||0),balanceAmount:s.balanceAmount+Number(a.balance_amount||0)}),{totalAmount:0,paidAmount:0,balanceAmount:0}),Y=()=>y.reduce((s,a)=>s+Number(a.used_qty||0),0),Z=s=>{const a=parseFloat(s.total_amount||0),h=parseFloat(s.paid_amount||0);return h===0?{text:"Unpaid",color:"danger"}:h>=a?{text:"Paid",color:"success"}:{text:"Partial",color:"warning"}},ee=async(s=null)=>{L(!0);try{const a=await k(`/api/project-summary${s?`?project_id=${s}`:""}`);z(a.data);const h=a.data.map(g=>({value:g.sr_no.toString(),label:`${g.site_name} - ${g.company_name}`}));Q(h),!s&&a.data.length>0&&(P(a.data[0].sr_no.toString()),A(0),V(a.data[0].sr_no),B(a.data[0].sr_no))}catch{D("Error fetching project summary data")}finally{L(!1)}};d.useEffect(()=>{ee()},[]);const se=s=>{if(s){P(s.value);const a=S.findIndex(h=>h.sr_no.toString()===s.value);a!==-1&&(A(a),V(s.value),B(s.value))}else P(""),A(0),f([]),p([])},ae=()=>{J(!w)},l=S[G],_=X(),le=Y();return I?e.jsx($,{fluid:!0,children:e.jsxs("div",{className:"text-center p-4",children:[e.jsx(T,{color:"primary"}),e.jsx("p",{className:"mt-2",children:"Loading project summary..."})]})}):e.jsx($,{fluid:!0,children:e.jsxs(m,{children:[e.jsx(te,{className:"bg-primary text-white",children:e.jsxs("h1",{className:"mb-0 h4 d-flex align-items-center",children:[e.jsx(C,{icon:ne,className:"me-2"})," Project Summary"]})}),e.jsxs(x,{className:"p-4",children:[F&&e.jsx(ce,{color:"danger",dismissible:!0,onClose:()=>D(""),children:F}),l&&e.jsxs(ie,{children:[e.jsx(m,{className:"mb-4 border-0",color:"primary",textColor:"dark",children:e.jsxs(x,{className:"bg-primary-subtle rounded",children:[e.jsxs("h5",{className:"text-primary mb-3 d-flex align-items-center",children:[e.jsx(C,{icon:oe,className:"me-2"})," Project Selection & Customer Information"]}),e.jsxs(u,{className:"g-3",children:[e.jsxs(t,{lg:6,md:12,children:[e.jsx(n,{children:"Select Project"}),e.jsx(re,{options:O,isSearchable:!0,isClearable:!0,placeholder:"Select a project...",value:O.find(s=>s.value===q)||null,onChange:se,className:"react-select-container",classNamePrefix:"react-select"})]}),e.jsxs(t,{lg:6,md:12,children:[e.jsx(n,{children:"Company Name"}),e.jsx(c,{value:l.company_name,readOnly:!0,className:"bg-white"})]})]})]})}),e.jsx(m,{className:"mb-4 border-0",color:l.is_profit?"success":"danger",textColor:"dark",children:e.jsxs(x,{className:`${l.is_profit?"bg-success-subtle":"bg-danger-subtle"} rounded`,children:[e.jsx("h5",{className:`${l.is_profit?"text-success":"text-danger"} mb-3`,children:l.is_profit?"ðŸ’° Profit":"ðŸ“‰ Loss"}),e.jsx(u,{className:"g-3 justify-content-center",children:e.jsxs(t,{lg:6,md:8,sm:12,children:[e.jsx(n,{className:"fs-5 fw-bold",children:l.is_profit?"Profit Amount":"Loss Amount"}),e.jsxs(i,{size:"lg",children:[e.jsx(o,{className:l.is_profit?"bg-success text-white":"bg-danger text-white",children:"â‚¹"}),e.jsx(c,{value:r(Math.abs(l.profit_or_loss)),readOnly:!0,className:`bg-white fw-bold fs-4 text-center ${l.is_profit?"text-success":"text-danger"}`})]})]})})]})}),e.jsx(m,{className:"mb-4 border-0",color:"secondary",textColor:"dark",children:e.jsxs(x,{className:"bg-secondary-subtle rounded",children:[e.jsx("h5",{className:"text-secondary mb-3",children:"Payment Received in Account"}),e.jsx(u,{className:"g-3",children:l.receiver_banks.map((s,a)=>e.jsxs(t,{xl:4,lg:6,md:6,sm:12,children:[e.jsx(n,{children:s.bank_name}),e.jsxs(i,{children:[e.jsx(o,{children:"â‚¹"}),e.jsx(c,{value:r(s.amount),readOnly:!0,className:"bg-white fw-bold"})]})]},a))})]})}),e.jsx(m,{className:"mb-4 border-0",color:"info",textColor:"dark",children:e.jsxs(x,{className:"bg-info-subtle rounded",children:[e.jsxs("div",{className:"d-flex gap-4 mb-3",children:[e.jsx("h5",{className:"text-info mb-0",children:"Payment / Invoice Details"}),e.jsxs("h5",{className:"text-dark mb-0",children:["( Total:",e.jsx("span",{className:"text-info fw-bold ms-1",children:r(Number(l.paid_amount)+Number(l.pending_amount))})," )"]})]}),e.jsxs(u,{className:"g-3",children:[e.jsxs(t,{lg:6,md:12,children:[e.jsx(n,{children:"Paid Amount"}),e.jsxs(i,{children:[e.jsx(o,{className:"bg-success text-white",children:"â‚¹"}),e.jsx(c,{value:r(l.paid_amount),readOnly:!0,className:"bg-white fw-bold text-success"})]})]}),e.jsxs(t,{lg:6,md:12,children:[e.jsx(n,{children:"Pending Amount"}),e.jsxs(i,{children:[e.jsx(o,{className:"bg-warning text-dark",children:"â‚¹"}),e.jsx(c,{value:r(l.pending_amount),readOnly:!0,className:"bg-white fw-bold text-warning"})]})]})]})]})}),e.jsx(m,{className:"mb-4 border-0",color:"success",textColor:"dark",children:e.jsxs(x,{className:"bg-success-subtle rounded",children:[e.jsxs("div",{className:"d-flex gap-4 mb-3",children:[e.jsx("h5",{className:"text-success mb-0",children:"Work Done"}),e.jsxs("h5",{className:"text-dark mb-0",children:["( Total Amount:",e.jsx("span",{className:"text-success fw-bold ms-1",children:r(Number(l.total_dth_billing_amount)+Number(l.total_survey_billing_amount))})," )"]})]}),e.jsxs(u,{className:"g-3",children:[e.jsxs(t,{xl:3,lg:6,md:6,sm:12,children:[e.jsx(n,{children:"Total DTH Points"}),e.jsx(c,{value:Number(l.total_dth_points||0).toLocaleString("en-IN"),readOnly:!0,className:"bg-white fw-bold text-center"})]}),e.jsxs(t,{xl:3,lg:6,md:6,sm:12,children:[e.jsx(n,{children:"Total DTH Billing Amount"}),e.jsxs(i,{children:[e.jsx(o,{children:"â‚¹"}),e.jsx(c,{value:r(l.total_dth_billing_amount),readOnly:!0,className:"bg-white fw-bold"})]})]}),e.jsxs(t,{xl:3,lg:6,md:6,sm:12,children:[e.jsx(n,{children:"Total Survey Points"}),e.jsx(c,{value:Number(l.total_survey_points||0).toLocaleString("en-IN"),readOnly:!0,className:"bg-white fw-bold text-center"})]}),e.jsxs(t,{xl:3,lg:6,md:6,sm:12,children:[e.jsx(n,{children:"Total Survey Billing Amount"}),e.jsxs(i,{children:[e.jsx(o,{children:"â‚¹"}),e.jsx(c,{value:r(l.total_survey_billing_amount),readOnly:!0,className:"bg-white fw-bold"})]})]})]})]})}),e.jsx(m,{className:"mb-4 border-0",color:"secondary",textColor:"dark",children:e.jsxs(x,{className:"bg-secondary-subtle rounded",children:[e.jsx("h5",{className:"text-secondary mb-3",children:"Final Billing"}),e.jsxs(u,{className:"g-3",children:[e.jsxs(t,{xl:4,lg:6,md:12,children:[e.jsx(n,{children:"Amount Before GST"}),e.jsxs(i,{children:[e.jsx(o,{children:"â‚¹"}),e.jsx(c,{value:r(l.final_bill),readOnly:!0,className:"bg-white fw-bold"})]})]}),e.jsxs(t,{xl:4,lg:6,md:12,children:[e.jsx(n,{children:"GST (18%)"}),e.jsxs(i,{children:[e.jsx(o,{children:"â‚¹"}),e.jsx(c,{value:r(l.gst_bill),readOnly:!0,className:"bg-white fw-bold"})]})]}),e.jsxs(t,{xl:4,lg:12,md:12,children:[e.jsx(n,{children:"Total Bill"}),e.jsxs(i,{children:[e.jsx(o,{children:"â‚¹"}),e.jsx(c,{value:r(l.total_bill),readOnly:!0,className:"bg-white fw-bold"})]})]})]})]})}),e.jsx(m,{className:"mb-4 border-0",color:"warning",textColor:"dark",children:e.jsxs(x,{className:"bg-warning-subtle rounded",children:[e.jsxs("div",{className:"d-flex gap-4 mb-3",children:[e.jsx("h5",{className:"text-warning mb-0",children:"Expenses"}),e.jsxs("h5",{className:"text-dark mb-0",children:["( Total:",e.jsx("span",{className:"text-warning fw-bold ms-1",children:r((Number(l.transport)||0)+(Number(l.other_billing)||0)+(Number(l.total_diesel_amount)||0)+(Number(l.extra_billing)||0))})," )"]})]}),e.jsxs(u,{className:"g-3",children:[e.jsxs(t,{xl:3,lg:6,md:6,sm:12,children:[e.jsx(n,{children:"Transport"}),e.jsxs(i,{children:[e.jsx(o,{children:"â‚¹"}),e.jsx(c,{value:r(l.transport),readOnly:!0,className:"bg-white fw-bold"})]})]}),e.jsxs(t,{xl:3,lg:6,md:6,sm:12,children:[e.jsx(n,{children:"Other Billing"}),e.jsxs(i,{children:[e.jsx(o,{children:"â‚¹"}),e.jsx(c,{value:r(l.other_billing),readOnly:!0,className:"bg-white fw-bold"})]})]}),e.jsxs(t,{xl:3,lg:6,md:6,sm:12,children:[e.jsx(n,{children:"Total Fuel Amount"}),e.jsxs(i,{children:[e.jsx(o,{children:"â‚¹"}),e.jsx(c,{value:r(l.total_diesel_amount),readOnly:!0,className:"bg-white fw-bold"})]})]}),e.jsxs(t,{xl:3,lg:6,md:6,sm:12,children:[e.jsx(n,{children:"Extra Billing"}),e.jsxs(i,{children:[e.jsx(o,{children:"â‚¹"}),e.jsx(c,{value:r(l.extra_billing),readOnly:!0,className:"bg-white fw-bold"})]})]})]})]})}),e.jsx(m,{className:"mb-4 border-0",color:"dark",textColor:"dark",children:e.jsxs(x,{className:"bg-dark-subtle rounded",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsxs("div",{className:"d-flex gap-4",children:[e.jsx("h5",{className:"text-dark mb-0",children:"Vendor Payments"}),N.length>0&&e.jsxs("h5",{className:"text-muted mb-0",children:["( Total:",e.jsx("span",{className:"text-dark fw-bold ms-1",children:r(_.totalAmount)})," )"]})]}),N.length>0&&e.jsxs(de,{color:"dark",variant:"outline",size:"sm",onClick:ae,children:[e.jsx(C,{icon:w?me:xe,className:"me-1"}),w?"Hide Details":"Show Details"]})]}),W?e.jsxs("div",{className:"text-center py-3",children:[e.jsx(T,{size:"sm"}),e.jsx("span",{className:"ms-2",children:"Loading vendor payments..."})]}):N.length>0?e.jsxs(e.Fragment,{children:[e.jsxs(u,{className:"g-3",children:[e.jsxs(t,{xl:4,lg:6,md:12,children:[e.jsx(n,{children:"Total Vendor Amount"}),e.jsxs(i,{children:[e.jsx(o,{className:"bg-dark text-white",children:"â‚¹"}),e.jsx(c,{value:r(_.totalAmount),readOnly:!0,className:"bg-white fw-bold"})]})]}),e.jsxs(t,{xl:4,lg:6,md:12,children:[e.jsx(n,{children:"Total Paid Amount"}),e.jsxs(i,{children:[e.jsx(o,{className:"bg-success text-white",children:"â‚¹"}),e.jsx(c,{value:r(_.paidAmount),readOnly:!0,className:"bg-white fw-bold text-success"})]})]}),e.jsxs(t,{xl:4,lg:12,md:12,children:[e.jsx(n,{children:"Total Remaining Amount"}),e.jsxs(i,{children:[e.jsx(o,{className:"bg-warning text-dark",children:"â‚¹"}),e.jsx(c,{value:r(_.balanceAmount),readOnly:!0,className:"bg-white fw-bold text-warning"})]})]})]}),e.jsx(he,{visible:w,children:e.jsxs("div",{className:"mt-4",children:[e.jsx("h6",{className:"text-dark mb-3",children:"Individual Vendor Details"}),e.jsx("div",{className:"table-responsive",children:e.jsxs(E,{striped:!0,hover:!0,className:"bg-white",children:[e.jsx(H,{color:"dark",children:e.jsxs(v,{children:[e.jsx(j,{children:"Vendor Name"}),e.jsx(j,{children:"Total Amount"}),e.jsx(j,{children:"Paid Amount"}),e.jsx(j,{children:"Balance Amount"}),e.jsx(j,{children:"Status"})]})}),e.jsx(U,{children:N.map(s=>{var h,g;const a=Z(s);return e.jsxs(v,{children:[e.jsx(b,{children:e.jsxs("div",{children:[e.jsx("div",{className:"fw-bold",children:((h=s.vendor)==null?void 0:h.name)||"Unknown Vendor"}),((g=s.vendor)==null?void 0:g.mobile)&&e.jsx("small",{className:"text-muted",children:s.vendor.mobile})]})}),e.jsx(b,{children:r(s.total_amount)}),e.jsx(b,{className:"text-success fw-bold",children:r(s.paid_amount)}),e.jsx(b,{className:"text-warning fw-bold",children:r(s.balance_amount)}),e.jsx(b,{children:e.jsx(ue,{color:a.color,children:a.text})})]},s.id)})})]})})]})})]}):e.jsx("div",{className:"text-center py-3 text-muted",children:e.jsx("p",{className:"mb-0",children:"No vendor payments found for this project"})})]})}),e.jsx(m,{className:"mb-4 border-0",color:"info",textColor:"dark",children:e.jsxs(x,{className:"bg-info-subtle rounded",children:[e.jsx("div",{className:"d-flex justify-content-between align-items-center mb-3",children:e.jsxs("div",{className:"d-flex gap-4",children:[e.jsx("h5",{className:"text-info mb-0",children:"Used Raw Material"}),y.length>0&&e.jsxs("h5",{className:"text-muted mb-0",children:["( Total Quantity:",e.jsx("span",{className:"text-info fw-bold ms-1",children:Number(le).toLocaleString("en-IN")})," )"]})]})}),K?e.jsxs("div",{className:"text-center py-3",children:[e.jsx(T,{size:"sm"}),e.jsx("span",{className:"ms-2",children:"Loading raw materials..."})]}):y.length>0?e.jsxs(e.Fragment,{children:[e.jsx(u,{className:"g-3 mb-4",children:e.jsx(t,{xl:12,lg:12,md:12})}),e.jsx("div",{children:e.jsx("div",{className:"table-responsive",children:e.jsxs(E,{striped:!0,hover:!0,className:"bg-white",children:[e.jsx(H,{color:"dark",children:e.jsxs(v,{children:[e.jsx(j,{children:"Material Name"}),e.jsx(j,{children:"Used Quantity"}),e.jsx(j,{children:"Amount"})]})}),e.jsx(U,{children:y.map(s=>e.jsxs(v,{children:[e.jsxs(b,{children:[e.jsx("div",{className:"fw-bold",children:s.material_name||"Unknown Material"}),s.local_name&&s.local_name!==s.material_name&&e.jsx("small",{className:"text-muted",children:s.local_name})]}),e.jsx(b,{children:Number(s.used_qty).toLocaleString("en-IN")}),e.jsx(b,{children:s.misc?Number(s.misc).toLocaleString("en-IN"):"-"})]},s.id))})]})})})]}):e.jsx("div",{className:"text-center py-3 text-muted",children:e.jsx("p",{className:"mb-0",children:"No raw materials found for this project"})})]})})]}),!I&&S.length===0&&e.jsxs("div",{className:"text-center p-4 text-muted",children:[e.jsx(C,{icon:je,size:"3xl",className:"mb-3"}),e.jsx("h5",{children:"No Projects Found"}),e.jsx("p",{children:"No project data available at the moment."})]})]})]})})};export{Ue as default};
