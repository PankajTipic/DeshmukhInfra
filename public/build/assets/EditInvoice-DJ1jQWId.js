import{d as T,u as A,e as N,r as m,b as v,j as c}from"./index-D77JVx93.js";import{a as h,b as j}from"./api-C2dAnRUz.js";import S from"./Invoice-Bd75lgUD.js";import{u as I}from"./DefaultLayout-B9m2Op0L.js";/* empty css                */import"./index.esm-CnYARBHd.js";import"./ProjectSelectionModal-DvSrAtUM.js";import"./CFormInput-l8xIFq1a.js";import"./CFormControlWrapper-Bm4xoNnJ.js";import"./CFormLabel-Dc8HuNh9.js";import"./CTable-_iNV6x85.js";import"./CButton-1GsZ7-l4.js";import"./CCardBody-CmpV1lA4.js";import"./CCardHeader-CTLciU6o.js";import"./CForm-CvVYu-wE.js";import"./CInputGroup-iSurCesp.js";import"./CInputGroupText-BPolkdL-.js";import"./cil-x-0440B5Ce.js";import"./cil-search-CDkY_4k-.js";import"./cil-plus-D8mtC-W5.js";import"./CFormSelect-BEYL04sy.js";import"./cil-pencil-m516yCOw.js";import"./CFormTextarea-BeYCqixl.js";import"./RawMaterial-BtjEDAbB.js";import"./cil-mobile-CeKkmNgt.js";const Z=()=>{const{id:a}=T(),u=A(),d=N(),n=new URLSearchParams(d.search).get("convertTo"),[p,l]=m.useState(null),[_,y]=m.useState(!0),[f,b]=m.useState(!1),{showToast:i}=v(),{t:o}=I("global");m.useEffect(()=>{(async()=>{try{const e=await h(`/api/order/${a}`);if(console.log("Fetched order:",e),e){const t=e.project||{};l({projectId:e.project_id||t.id||null,customer_id:e.customer_id||null,projectName:t.project_name||"N/A",customer:{name:t.customer_name||"Unknown",address:t.work_place||"",mobile:t.mobile_number||""},lat:e.lat||"",long:e.long||"",payLater:!!e.payLater,isSettled:!!e.isSettled,invoiceDate:e.invoiceDate||"",deliveryTime:e.deliveryTime||"",deliveryDate:e.deliveryDate||"",invoiceType:n?parseInt(n):e.invoiceType||3,orderStatus:n?parseInt(n):e.orderStatus||1,items:(e.items||[]).map(r=>({id:r.id,work_type:r.work_type||"",uom:r.uom||"",qty:Number(r.qty||0),price:Number(r.price||0),total_price:Number(r.total_price||0),remark:r.remark||"",gst_percent:Number(r.gst_percent||0),cgst_amount:Number(r.cgst_amount||0),sgst_amount:Number(r.sgst_amount||0)})),totalAmount:Number(e.totalAmount||0),discount:Number(e.discount||0),paidAmount:Number(e.paidAmount||0),finalAmount:Number(e.finalAmount||0),balanceAmount:Number(e.finalAmount||0)-Number(e.paidAmount||0),paymentType:e.paymentType||0,company_id:e.company_id||null,payment_terms:e.payment_terms||"",terms_and_conditions:e.terms_and_conditions||"",note:e.note||"",ref_id:e.ref_id||"",po_number:e.po_number||""}),b(!0)}else i("danger","No order data found")}catch(e){console.error("Fetch order error:",e),i("danger",o("TOAST.fetch_order_failed"))}finally{y(!1)}})()},[a,n,o]);const g=async s=>{try{const e={...s,id:a,project_id:s.projectId,remainingBalance:Number(s.finalAmount||0)-Number(s.paidAmount||0)};console.log("Updating order:",e);const t=await j(`/api/order/${a}`,e);t!=null&&t.success?(i("success",o("TOAST.order_updated")),u(`/invoice-details/${a}`)):i("danger",(t==null?void 0:t.message)||o("TOAST.update_failed"))}catch(e){console.error("Update error:",e),i("danger",o("TOAST.update_error"))}};return _||!f?c.jsx("div",{children:o("TOAST.loading")}):c.jsx(S,{editMode:!0,initialData:p,onSubmit:g})};export{Z as default};
